var dataList,len,timer,sporPer,root=window.player,nowIndex=0,audio=root.audioManager;function getData(o){$.ajax({type:"GET",url:o,success:function(o){len=(dataList=o).length,root.getList(dataList),root.render(dataList[0]),audio.getAudio(dataList[0].audio),root.pro.renderAllTime(dataList[0].duration),bindEvent(),bindTouch()},error:function(){}})}function bindEvent(){$("body").on("mychange",function(){root.render(dataList[nowIndex]),audio.getAudio(dataList[nowIndex].audio),$(".img-box").attr("data-deg","0"),$(".img-box").css({transform:"rotateZ(0deg)",transition:"none"}),audio.play(),rotated(0),$(".play").addClass("playing"),root.pro.renderAllTime(dataList[nowIndex].duration),root.pro.start()}),$(".prev").on("click",function(){0==nowIndex?nowIndex=len-1:nowIndex--,$("body").trigger("mychange")}),$(".next").on("click",function(){nowIndex==len-1?nowIndex=0:nowIndex++,$("body").trigger("mychange")}),$(".play").on("click",function(){if("pause"==audio.status){var o=$(".img-box").attr("data-deg");audio.play(),root.pro.start(),rotated(o),$(".play").addClass("playing")}else audio.pause(),clearInterval(timer),root.pro.stop(),$(".play").removeClass("playing")}),$(".list").on("click",function(){$(".list").toggleClass("listing"),$(".musicList").toggleClass("musicListing")}),$(".musicList  ul li").on("click",function(o){nowIndex=$(this).index(),$("body").trigger("mychange"),$(".musicList").css({transition:"3s linear"}),$(".musicList").toggleClass("musicListing")})}function bindTouch(){var o=$(".spot");o.on("touchstart",function(){audio.pause(),root.pro.stop()}),o.on("touchmove",function(o){audio.pause(),root.pro.stop();var t=o.changedTouches[0].clientX-$(".cur-time").width(),n=$(".pro-bottom").width();0<=(sporPer=t/n)&&sporPer<=1&&(root.pro.start(),$(".pro-top").width(100*sporPer+"%"))}),o.on("touchend",function(o){if(0<=sporPer&&sporPer<=1){var t=sporPer*audio.audio.duration;audio.audio.currentTime=t,root.pro.start(),audio.play()}})}function rotated(o){clearInterval(timer),o=parseInt(o),timer=setInterval(function(){o+=10,$(".img-box").attr("data-deg",o),$(".img-box").css({transform:"rotateZ("+o+"deg)",transition:"rotateZ 3s linear 2s"})},200)}getData("../mock/data.json"),setInterval(function(){audio.audio.currentTime==audio.audio.duration&&(len-1<(nowIndex+=1)&&(nowIndex=0),$("body").trigger("mychange"))},1e3);